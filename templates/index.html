<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Live Assistant</title>
    <style>
        /* RGB Glow and Layout */
        body { background: #000; color: white; font-family: sans-serif; margin: 0; text-align: center; }
        #avatar-container { 
            width: 300px; height: 300px; margin: 20px auto; 
            border-radius: 50%; overflow: hidden; 
            border: 4px solid #0f0; box-shadow: 0 0 20px #0f0;
            background: #111; position: relative;
        }
        #live-canvas { width: 100%; height: 100%; object-fit: cover; }
        
        .chat-box { width: 90%; max-width: 400px; margin: auto; background: #111; border-radius: 15px; padding: 15px; border: 1px solid #333; }
        #messages { height: 200px; overflow-y: auto; text-align: left; font-size: 14px; margin-bottom: 10px; }
        input { width: 70%; padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px; background: #0f0; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <h2>DEV LIVE AI ASSISTANT</h2>

    <div id="avatar-container">
        <canvas id="live-canvas"></canvas>
    </div>

    <div class="chat-box">
        <div id="messages"></div>
        <input type="text" id="user-input" placeholder="Dev se baat karein...">
        <button onclick="sendMsg()">SEND</button>
    </div>

    <script src="https://unpkg.com/talkinghead@1.1.0/dist/talkinghead.mjs" type="module"></script>

    <script type="module">
        import { TalkingHead } from "https://unpkg.com/talkinghead@1.1.0/dist/talkinghead.mjs";

        let head;
        const node = document.getElementById('avatar-container');

        // Avatar Initializing (3D Model / Photo animation)
        async function initAvatar() {
            head = new TalkingHead(node, {
                model: "https://models.readyplayer.me/64b52994963595603a1104e1.glb", // Ye ek 3D model hai, aap ise apni photo se replace kar sakte hain later
                cameraView: "head"
            });
            await head.init();
        }

        window.sendMsg = async () => {
            const input = document.getElementById('user-input');
            const msg = input.value;
            if(!msg) return;

            // Display message
            document.getElementById('messages').innerHTML += `<div><b>You:</b> ${msg}</div>`;
            input.value = "";

            // Fetch Reply from your Flask App
            const res = await fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: msg})
            });
            const data = await res.json();

            // Display Reply
            document.getElementById('messages').innerHTML += `<div><b>Dev:</b> ${data.reply}</div>`;

            // LIVE AVATAR SPEECH (Munh hilana aur Bolna)
            // Ye library apne aap lip-sync karegi
            head.speakText(data.reply); 
        };

        initAvatar();
    </script>
</body>
</html>
